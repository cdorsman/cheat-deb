name: Check
on:
  schedule:
    - cron: '0 0 1 1-12 *'
  workflow_dispatch:
jobs:
  check:
    runs-on: ubuntu-24.04
    steps:
      - name: Create buildroot
        id: create-buildroot
        run: |
          mkdir -p buildroot/tmp;
          echo "buildroot=buildroot/" >> $GITHUB_OUTPUT
          echo "buildroot=buildroot/" >> $GITHUB_ENV
          
      - name: Get latest release from cheat
        id: get_release
        run: |
          # Fetch release information and extract the release tag
          RELEASE_TAG=$(curl -sL https://api.github.com/repos/cheat/cheat/releases/latest | jq -r '.tag_name')
          echo "release_tag=$RELEASE_TAG" >> $GITHUB_OUTPUT
          echo "latest release: $RELEASE_TAG"

      - name: Download Assets
        uses: i3h/download-release-asset@v1.3.3
        with:
          owner: cheat
          repo: cheat 
          tag: ${{ steps.get_release.outputs.RELEASE_TAG  }}
          file: cheat-linux-amd64.gz
          path:  ${{ env.buildroot }}/tmp

      - name: Decompress package
        run: gunzip ${{ env.buildroot }}/tmp/cheat-linux-amd64.gz
          
      - name: Call workflow to build code
        uses: benc-uk/workflow-dispatch@v1
        with:
          workflow: build.yml
